<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#d46a2d">
  <title>Pedometer Web</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="app-shell">
    <header class="hero">
      <p class="hero-badge">Cross Platform</p>
      <h1>Pedometer Web</h1>
      <p class="hero-subtitle">iOS / Android / PC ブラウザで動く歩数計</p>
    </header>

    <nav class="tabs" aria-label="Main tabs">
      <button id="tab-button-today" class="tab-button is-active" data-tab="today" type="button">Today</button>
      <button id="tab-button-history" class="tab-button" data-tab="history" type="button">History</button>
      <button id="tab-button-settings" class="tab-button" data-tab="settings" type="button">Settings</button>
    </nav>

    <main>
      <section id="tab-today" class="tab-panel" data-tab-panel="today">
        <article class="card status-card">
          <div>
            <p class="label">Tracking Status</p>
            <p id="tracking-status" class="status-chip">停止中</p>
          </div>
          <p id="sensor-status" class="muted">センサー状態を確認中...</p>
          <p id="today-message" class="message" aria-live="polite"></p>
          <div class="button-row">
            <button id="start-tracking" class="btn primary" type="button">計測開始</button>
            <button id="stop-tracking" class="btn" type="button">停止</button>
          </div>
          <div class="button-row">
            <button id="manual-step" class="btn" type="button">+1 歩（手動）</button>
            <button id="reset-today" class="btn danger" type="button">今日の計測をリセット</button>
          </div>
        </article>

        <article class="card metrics-card">
          <h2>今日のメトリクス</h2>
          <dl class="metrics-grid">
            <div>
              <dt>歩数</dt>
              <dd id="metric-steps">0 歩</dd>
            </div>
            <div>
              <dt>総距離</dt>
              <dd id="metric-distance">0.00 km</dd>
            </div>
            <div>
              <dt>平均速度</dt>
              <dd id="metric-speed">0.00 km/h</dd>
            </div>
            <div>
              <dt>消費カロリー</dt>
              <dd id="metric-calories">0 kcal</dd>
            </div>
            <div>
              <dt>早歩き時間</dt>
              <dd id="metric-brisk-duration">00:00</dd>
            </div>
            <div>
              <dt>早歩き距離</dt>
              <dd id="metric-brisk-distance">0.00 km</dd>
            </div>
            <div>
              <dt>走行時間</dt>
              <dd id="metric-running-duration">00:00</dd>
            </div>
            <div>
              <dt>走行距離</dt>
              <dd id="metric-running-distance">0.00 km</dd>
            </div>
          </dl>
          <p id="last-updated" class="muted"></p>
        </article>
      </section>

      <section id="tab-history" class="tab-panel is-hidden" data-tab-panel="history">
        <article class="card">
          <h2>履歴</h2>
          <div class="filter-row" role="group" aria-label="History range filter">
            <button class="filter-button is-active" data-history-days="all" type="button">全期間</button>
            <button class="filter-button" data-history-days="7" type="button">7日</button>
            <button class="filter-button" data-history-days="30" type="button">30日</button>
          </div>
          <p id="history-count" class="muted">表示件数: 0 日分</p>

          <dl class="summary-grid">
            <div>
              <dt>直近7日 歩数</dt>
              <dd id="summary-week-steps">0 歩</dd>
            </div>
            <div>
              <dt>直近7日 距離</dt>
              <dd id="summary-week-distance">0.00 km</dd>
            </div>
            <div>
              <dt>直近7日 消費</dt>
              <dd id="summary-week-calories">0 kcal</dd>
            </div>
            <div>
              <dt>直近30日 歩数</dt>
              <dd id="summary-month-steps">0 歩</dd>
            </div>
            <div>
              <dt>直近30日 距離</dt>
              <dd id="summary-month-distance">0.00 km</dd>
            </div>
            <div>
              <dt>直近30日 消費</dt>
              <dd id="summary-month-calories">0 kcal</dd>
            </div>
          </dl>

          <h3>直近の歩数推移</h3>
          <div id="history-chart" class="history-chart" aria-label="歩数バーグラフ"></div>

          <div class="button-row">
            <button id="download-csv" class="btn primary" type="button">CSVエクスポート</button>
            <button id="share-csv" class="btn" type="button">CSV共有</button>
          </div>
          <p id="history-message" class="message" aria-live="polite"></p>
        </article>

        <article class="card">
          <h3>日次データ</h3>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>日付</th>
                  <th>歩数</th>
                  <th>距離</th>
                  <th>消費</th>
                </tr>
              </thead>
              <tbody id="history-table-body">
                <tr>
                  <td colspan="4" class="muted">履歴データがありません。</td>
                </tr>
              </tbody>
            </table>
          </div>
        </article>
      </section>

      <section id="tab-settings" class="tab-panel is-hidden" data-tab-panel="settings">
        <article class="card">
          <h2>プロフィール設定</h2>
          <div class="field-grid">
            <label class="field">
              身長 (cm)
              <input id="input-height" type="number" min="120" max="220" step="1" inputmode="numeric" value="170">
            </label>
            <label class="field">
              体重 (kg, 任意)
              <input id="input-weight" type="number" min="30" max="200" step="0.1" inputmode="decimal" placeholder="未入力なら推定">
            </label>
            <label class="field">
              性別
              <select id="input-sex">
                <option value="MALE">男性</option>
                <option value="FEMALE">女性</option>
                <option value="OTHER">その他</option>
              </select>
            </label>
            <label class="field">
              歩幅補正: <span id="stride-scale-label">1.00x</span>
              <input id="input-stride-scale" type="range" min="0.7" max="1.3" step="0.05" value="1.0">
            </label>
          </div>

          <dl class="summary-grid">
            <div>
              <dt>推定歩幅 (歩行)</dt>
              <dd id="preview-walk">0.00 m</dd>
            </div>
            <div>
              <dt>推定歩幅 (早歩き)</dt>
              <dd id="preview-brisk">0.00 m</dd>
            </div>
            <div>
              <dt>推定歩幅 (走行)</dt>
              <dd id="preview-running">0.00 m</dd>
            </div>
            <div>
              <dt>カロリー計算体重</dt>
              <dd id="preview-weight">0.0 kg</dd>
            </div>
          </dl>

          <h3>実測から補正算出</h3>
          <div class="field-grid">
            <label class="field">
              実測時の歩数
              <input id="input-calibration-steps" type="number" min="1" step="1" inputmode="numeric">
            </label>
            <label class="field">
              実測距離 (m)
              <input id="input-calibration-distance" type="number" min="0.1" step="0.1" inputmode="decimal">
            </label>
          </div>
          <div class="button-row">
            <button id="recalc-scale" class="btn" type="button">実測から補正算出</button>
            <button id="save-settings" class="btn primary" type="button">設定を保存</button>
          </div>
          <div class="button-row">
            <button id="clear-local-data" class="btn danger" type="button">保存データを削除</button>
          </div>
          <p class="muted">共有端末では使用後に保存データの削除を推奨します。</p>
          <p id="settings-message" class="message" aria-live="polite"></p>
        </article>
      </section>
    </main>

    <footer class="footer-note">
      iOSでは「計測開始」時にモーション許可が必要です。HTTPS か localhost で開いてください。
    </footer>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
